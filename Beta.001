from datetime import datetime
import PySimpleGUI as sg
import openpyxl as ox


def pass_for_excel(COD):
    fileExcel = ox.load_workbook('./Testes/registroPonto.xlsx')
    pl = fileExcel.active
    size_list = len(pl['A'])

    for i in range((size_list+1), (size_list+2)):
        A = f'A{i}'
        B = f'B{i}'
        C = f'C{i}'
        D = f'D{i}'
        E = f'E{i}'
        F = f'F{i}'
        pl[A].value = COD
        pl[B].value = cod[COD]
        if pl[C].value == None:
            pl[C].value = timeRegistered
        elif pl[D].value == None:
            pl[D].value = timeRegistered
        elif pl[E].value == None:
            pl[E].value = timeRegistered
        elif pl[F].value == None:
            pl[F].value = timeRegistered
        fileExcel.save('./Testes/registroPonto.xlsx')

def first_screen():
    layout = [
        [sg.Text('Codigo:'), sg.Input(key='COD')],
        [sg.Button('Enviar', key='ENV')]
    ]
    return sg.Window('One Point', layout=layout, finalize=True,
    resizable=True, return_keyboard_events=True)

timeNow = float(datetime.now().strftime('%H.%M'))
timeRegistered = datetime.now().strftime('%H:%M')
cod = {'1': 'julio','2': 'luciene'}


def registered_point():
    if timeNow > 8.50 and timeNow < 21.10:
        win1, win2 = first_screen(), None
        
        while True:
            window, event, value = sg.read_all_windows()
            
            if window == win1 and event == sg.WIN_CLOSED:
                break
            
            if window == win1 and event == 'ENV':
                if value['COD'] in cod.keys():
                    registered = value['COD']
                    #fazer função para registrar o ponto no excel e colocar aqui
                    pass_for_excel(registered)
                    sg.popup('Ponto Registrado')
                    window.FindElement('COD').Update('')
                    
                elif value['COD'] not in cod.keys():
                    sg.popup('Funcionario(a) não cadastrado(a)')
                    window.FindElement('COD').Update('')
        
    elif timeNow < 8.50 or timeNow > 21.10:
        sg.popup('Fora da hora de funcionamento')
registered_point()
